NAMESPACE=auto-jumpstarter

# config git
USER_EMAIL=`cat /config/user/profile/email | sed -E 's/^([^@]+@[^@]+\.[^@]+)@.*/\1/'`
USER_NAME=`cat /config/user/profile/name`

git config --global user.email $USER_EMAIL
git config --global user.name $USER_NAME

# generate jumpstarter user config
cat > /home/user/.config/jumpstarter/config.yaml <<EOF
apiVersion: jumpstarter.dev/v1alpha1
kind: UserConfig
config:
  current-client: default
EOF

CLIENT_NAME="$USER_NAME-default"
if oc get client "$CLIENT_NAME" -n $NAMESPACE &>/dev/null; then
  oc delete client "$CLIENT_NAME" -n $NAMESPACE || true
fi

# generate jumpstarter client config
jmp admin create client --insecure-tls-config --unsafe --nointeractive --save -n $NAMESPACE --out /home/user/.config/jumpstarter/clients/default.yaml $CLIENT_NAME